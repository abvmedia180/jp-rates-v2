<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Headway Reimbursement Rates - Advanced Analytics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f3f4f6;
        }
        
        .header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 { font-size: 1.8em; margin-bottom: 8px; }
        .header p { font-size: 1em; opacity: 0.95; }
        
        .controls {
            padding: 20px;
            background: white;
            border-bottom: 2px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .search-box { margin-bottom: 15px; }
        
        .search-box input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #1e40af;
        }
        
        .filter-section {
            margin-bottom: 15px;
        }
        
        .filter-label {
            font-size: 13px;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 8px;
            display: block;
        }
        
        .filter-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .filter-btn {
            padding: 10px 16px;
            border: 2px solid #1e40af;
            background: white;
            color: #1e40af;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            background: #eff6ff;
        }
        
        .filter-btn.active {
            background: #1e40af;
            color: white;
        }
        
        .sort-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .sort-select {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        
        .view-toggle {
            display: flex;
            gap: 5px;
            margin-left: auto;
        }
        
        .view-btn {
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .view-btn.active {
            background: #1e40af;
            color: white;
            border-color: #1e40af;
        }
        
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #f9fafb;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #1e40af;
        }
        
        .stat-label {
            font-size: 13px;
            color: #6b7280;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1e40af;
        }
        
        .stat-subtext {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 5px;
        }
        
        .scroll-hint {
            padding: 10px;
            background: #fef3c7;
            color: #92400e;
            text-align: center;
            font-size: 13px;
        }
        
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
            background: white;
        }
        
        th {
            background: #1e40af;
            color: white;
            padding: 14px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        
        th:hover {
            background: #1e3a8a;
        }
        
        th:first-child,
        td:first-child {
            position: sticky;
            left: 0;
            z-index: 10;
            background: #1e40af;
        }
        
        td:first-child {
            background: white;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
        }
        
        tbody tr:nth-child(even) td:first-child {
            background: #f9fafb;
        }
        
        tbody tr:hover td:first-child {
            background: #eff6ff !important;
        }
        
        th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.5;
        }
        
        th.sorted-asc::after {
            content: ' ‚Üë';
            opacity: 1;
        }
        
        th.sorted-desc::after {
            content: ' ‚Üì';
            opacity: 1;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 13px;
        }
        
        tbody tr {
            transition: background-color 0.2s;
        }
        
        tbody tr:nth-child(even) { background-color: #f9fafb; }
        
        tbody tr:hover {
            background-color: #eff6ff !important;
        }
        
        .cpt-code {
            font-weight: 600;
            color: #1e40af;
        }
        
        .description { color: #4b5563; }
        
        .rate {
            font-weight: 600;
            color: #10b981;
            text-align: center;
        }
        
        .rate.highlight-high {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .rate.highlight-low {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .avg-rate {
            font-weight: 600;
            color: #6366f1;
            text-align: center;
            background-color: #eef2ff;
        }
        
        .analytics-section {
            padding: 25px 20px;
            background: white;
            margin: 10px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .analytics-section h2 {
            color: #1e40af;
            font-size: 1.4em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .ranking-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
        }
        
        .ranking-card h3 {
            font-size: 1.1em;
            color: #1e40af;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .medal {
            font-size: 1.3em;
        }
        
        .ranking-list {
            list-style: none;
        }
        
        .ranking-item {
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #1e40af;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ranking-item:nth-child(1) { border-left-color: #fbbf24; }
        .ranking-item:nth-child(2) { border-left-color: #9ca3af; }
        .ranking-item:nth-child(3) { border-left-color: #cd7f32; }
        
        .ranking-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 14px;
        }
        
        .ranking-value {
            font-weight: 700;
            color: #10b981;
            font-size: 16px;
        }
        
        .chart-container {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bar-label {
            min-width: 180px;
            font-size: 13px;
            font-weight: 600;
            color: #4b5563;
        }
        
        .bar-wrapper {
            flex: 1;
            background: #e5e7eb;
            border-radius: 8px;
            height: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #1e40af 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            transition: width 1s ease-out;
        }
        
        .comparison-tool {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .comparison-tool h3 {
            font-size: 1.1em;
            color: #1e40af;
            margin-bottom: 15px;
        }
        
        .comparison-selects {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .comparison-selects select {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .comparison-result {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .comparison-result.show {
            display: block;
        }
        
        .info-section {
            padding: 25px 20px;
            background: #f9fafb;
        }
        
        .info-section h2 {
            color: #1e40af;
            font-size: 1.3em;
            margin-bottom: 12px;
        }
        
        .info-section p {
            color: #4b5563;
            line-height: 1.7;
            font-size: 14px;
        }
        
        .footer {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 13px;
        }
        
        .hidden { display: none; }
        
        @media (max-width: 768px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Headway Reimbursement Rates - Advanced Analytics</h1>
        <p>Joseph Psychiatry PLLC - New York</p>
    </div>
    
    <div class="stats-dashboard">
        <div class="stat-card">
            <div class="stat-label">Total CPT Codes</div>
            <div class="stat-value" id="totalCodes">23</div>
            <div class="stat-subtext">Across all categories</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Avg Rate (All Codes)</div>
            <div class="stat-value" id="avgRate">$108.45</div>
            <div class="stat-subtext">Across all insurers</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Highest Single Rate</div>
            <div class="stat-value" id="highestRate">$231.16</div>
            <div class="stat-subtext" id="highestRateCode">CPT 99205</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Most Common Session</div>
            <div class="stat-value">90834</div>
            <div class="stat-subtext">45-min psychotherapy</div>
        </div>
    </div>
    
    <div class="controls">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="üîç Search CPT code or description..." onkeyup="searchTable()">
        </div>
        
        <div class="filter-section">
            <span class="filter-label">Category Filters:</span>
            <div class="filter-group">
                <button class="filter-btn active" onclick="filterTable('all', this)">All Codes</button>
                <button class="filter-btn" onclick="filterTable('mypractice', this)">My Practice Codes</button>
                <button class="filter-btn" onclick="filterTable('psychotherapy', this)">Psychotherapy</button>
                <button class="filter-btn" onclick="filterTable('evaluation', this)">Evaluation & Management</button>
                <button class="filter-btn" onclick="filterTable('crisis', this)">Crisis Intervention</button>
                <button class="filter-btn" onclick="filterTable('family', this)">Family & Group</button>
                <button class="filter-btn" style="margin-left: 10px; border-color: #dc2626; color: #dc2626;" onclick="resetAllFilters(this)">Reset All Filters</button>
            </div>
        </div>
        
        <div class="filter-section">
            <span class="filter-label">Session Duration:</span>
            <div class="filter-group">
                <button class="filter-btn" onclick="filterByDuration('short', this)">Short (< 30 min)</button>
                <button class="filter-btn" onclick="filterByDuration('medium', this)">Medium (30-45 min)</button>
                <button class="filter-btn" onclick="filterByDuration('long', this)">Long (45-60 min)</button>
                <button class="filter-btn" onclick="filterByDuration('extended', this)">Extended (60+ min)</button>
            </div>
        </div>
        
        <div class="filter-section">
            <span class="filter-label">Rate Range:</span>
            <div class="filter-group">
                <button class="filter-btn" onclick="filterByRate('low', this)">Low (< $75)</button>
                <button class="filter-btn" onclick="filterByRate('medium', this)">Medium ($75-$150)</button>
                <button class="filter-btn" onclick="filterByRate('high', this)">High ($150+)</button>
            </div>
        </div>
        
        <div class="sort-controls">
            <span class="filter-label">Sort by:</span>
            <select class="sort-select" id="sortSelect" onchange="sortTable()">
                <option value="default">Default Order</option>
                <option value="code-asc">CPT Code (A-Z)</option>
                <option value="code-desc">CPT Code (Z-A)</option>
                <option value="avg-high">Average Rate (High-Low)</option>
                <option value="avg-low">Average Rate (Low-High)</option>
            </select>
            
            <div class="view-toggle">
                <button class="view-btn active" onclick="toggleHighlight('none', this)">Normal</button>
                <button class="view-btn" onclick="toggleHighlight('extremes', this)">Highlight Extremes</button>
            </div>
        </div>
    </div>
    
    <div class="scroll-hint">‚Üê Scroll to see all insurance rates ‚Üí</div>
    
    <div class="table-wrapper">
        <table id="dataTable">
            <thead>
                <tr>
                    <th class="sortable" onclick="sortTableByColumn(0)" data-sort="">CPT Code</th>
                    <th class="sortable" onclick="sortTableByColumn(1)" data-sort="">Description</th>
                    <th class="sortable" onclick="sortTableByColumn(2)" data-sort="">Aetna</th>
                    <th class="sortable" onclick="sortTableByColumn(3)" data-sort="">Anthem BCBS</th>
                    <th class="sortable" onclick="sortTableByColumn(4)" data-sort="">Carelon</th>
                    <th class="sortable" onclick="sortTableByColumn(5)" data-sort="">Cigna</th>
                    <th class="sortable" onclick="sortTableByColumn(6)" data-sort="">Independence BCBS PA</th>
                    <th class="sortable" onclick="sortTableByColumn(7)" data-sort="">Oscar</th>
                    <th class="sortable" onclick="sortTableByColumn(8)" data-sort="">Oxford</th>
                    <th class="sortable" onclick="sortTableByColumn(9)" data-sort="">Quest</th>
                    <th class="sortable" onclick="sortTableByColumn(10)" data-sort="">UnitedHealthcare</th>
                    <th class="sortable" onclick="sortTableByColumn(11)" data-sort="">Avg Rate</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Table rows will be populated by JavaScript -->
            </tbody>
        </table>
    </div>
    
    <div class="analytics-section">
        <h2>üíä Psychiatric Medication Management Revenue Model</h2>
        <p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">Common billing structure: Initial intake (90791/90792) + Follow-up visits (99213/99214 + 90833 modifier)</p>
        
        <div class="analytics-grid">
            <div class="ranking-card">
                <h3><span class="medal">üìã</span> Initial Intake Codes</h3>
                <p style="font-size: 12px; color: #6b7280; margin-bottom: 12px;">Average rates across all insurers</p>
                <ul class="ranking-list">
                    <li class="ranking-item">
                        <div>
                            <div class="ranking-name">90791 - Psych Diagnostic Eval</div>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 3px;">Standard psychiatric evaluation</div>
                        </div>
                        <span class="ranking-value" id="avg90791">$182.26</span>
                    </li>
                    <li class="ranking-item">
                        <div>
                            <div class="ranking-name">90792 - Psych Eval + Medical</div>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 3px;">With medical services component</div>
                        </div>
                        <span class="ranking-value" id="avg90792">$185.21</span>
                    </li>
                </ul>
            </div>
            
            <div class="ranking-card">
                <h3><span class="medal">üíä</span> Follow-Up Medication Management</h3>
                <p style="font-size: 12px; color: #6b7280; margin-bottom: 12px;">Average rates across all insurers</p>
                <ul class="ranking-list">
                    <li class="ranking-item">
                        <div>
                            <div class="ranking-name">99213 + 90833 (20 min)</div>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 3px;">E&M + 30-min psychotherapy add-on</div>
                        </div>
                        <span class="ranking-value" id="avg99213combo">$158.70</span>
                    </li>
                    <li class="ranking-item">
                        <div>
                            <div class="ranking-name">99214 + 90833 (30 min)</div>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 3px;">E&M + 30-min psychotherapy add-on</div>
                        </div>
                        <span class="ranking-value" id="avg99214combo">$187.87</span>
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="chart-container">
            <h3 style="color: #1e40af; margin-bottom: 20px;">Revenue by Insurance Company</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                <div>
                    <h4 style="font-size: 14px; color: #4b5563; margin-bottom: 15px; font-weight: 600;">90791 - Initial Intake (Standard)</h4>
                    <div class="bar-chart" id="intake90791Chart"></div>
                </div>
                <div>
                    <h4 style="font-size: 14px; color: #4b5563; margin-bottom: 15px; font-weight: 600;">90792 - Initial Intake (with Medical)</h4>
                    <div class="bar-chart" id="intake90792Chart"></div>
                </div>
                <div>
                    <h4 style="font-size: 14px; color: #4b5563; margin-bottom: 15px; font-weight: 600;">99213 + 90833 - Follow-up (20 min)</h4>
                    <div class="bar-chart" id="followup99213Chart"></div>
                </div>
                <div>
                    <h4 style="font-size: 14px; color: #4b5563; margin-bottom: 15px; font-weight: 600;">99214 + 90833 - Follow-up (30 min)</h4>
                    <div class="bar-chart" id="followup99214Chart"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="analytics-section">
        <h2>üíº Practice Revenue Calculator</h2>
        
        <div class="comparison-tool">
            <h3>üí∞ Monthly Revenue Projector - Medication Management Model</h3>
            <p style="color: #6b7280; font-size: 14px; margin-bottom: 15px;">Calculate revenue based on new patient intakes + ongoing medication management follow-ups</p>
            
            <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #3b82f6;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 10px;">
                    <h4 style="font-size: 14px; font-weight: 600; color: #1e40af; margin: 0;">Insurance Panel Selection</h4>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="selectTopPayers(3, 'forward')" style="padding: 6px 12px; border: 2px solid #10b981; background: white; color: #10b981; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Top 3</button>
                        <button onclick="selectTopPayers(4, 'forward')" style="padding: 6px 12px; border: 2px solid #10b981; background: white; color: #10b981; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Top 4</button>
                        <button onclick="selectTopPayers(5, 'forward')" style="padding: 6px 12px; border: 2px solid #10b981; background: white; color: #10b981; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Top 5</button>
                        <button onclick="clearAllPayers('forward')" style="padding: 6px 12px; border: 2px solid #dc2626; background: white; color: #dc2626; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Clear All</button>
                    </div>
                </div>
                <p style="font-size: 12px; color: #6b7280; margin-bottom: 10px;">Select insurers you accept (or leave blank for overall average)</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="insurer-checkbox" value="0" onchange="calculateRevenue()"> Aetna
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="insurer-checkbox" value="1" onchange="calculateRevenue()"> Anthem BCBS
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="insurer-checkbox" value="2" onchange="calculateRevenue()"> Carelon
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="insurer-checkbox" value="3" onchange="calculateRevenue()"> Cigna
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="insurer-checkbox" value="4" onchange="calculateRevenue()"> Independence BCBS PA
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="insurer-checkbox" value="5" onchange="calculateRevenue()"> Oscar
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="insurer-checkbox" value="6" onchange="calculateRevenue()"> Oxford
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="insurer-checkbox" value="7" onchange="calculateRevenue()"> Quest
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="insurer-checkbox" value="8" onchange="calculateRevenue()"> UnitedHealthcare
                    </label>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 8px;">
                        New Patients/Month: <span id="newPatientsDisplay" style="color: #1e40af;">8</span>
                    </label>
                    <input type="range" id="newPatientsMonth" value="8" min="0" max="100" 
                           style="width: 100%;"
                           oninput="document.getElementById('newPatientsDisplay').textContent = this.value; calculateRevenue();">
                    <div style="font-size: 11px; color: #9ca3af; margin-top: 3px;">Initial intake appointments</div>
                </div>
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 8px;">
                        Follow-up Visits/Month: <span id="followupVisitsDisplay" style="color: #1e40af;">60</span>
                    </label>
                    <input type="range" id="followupVisitsMonth" value="60" min="0" max="1000" 
                           style="width: 100%;"
                           oninput="document.getElementById('followupVisitsDisplay').textContent = this.value; calculateRevenue();">
                    <div style="font-size: 11px; color: #9ca3af; margin-top: 3px;">Ongoing medication management</div>
                </div>
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 5px;">Intake Code</label>
                    <select id="intakeCode" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" onchange="calculateRevenue()">
                        <option value="90791">90791 - Standard Eval</option>
                        <option value="90792">90792 - Eval + Medical</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 5px;">Follow-up Code</label>
                    <select id="followupCode" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" onchange="calculateRevenue()">
                        <option value="99213">99213 + 90833 (20 min)</option>
                        <option value="99214" selected>99214 + 90833 (30 min)</option>
                    </select>
                </div>
            </div>
            <div id="revenueResult" style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #10b981;">
                <h4 style="color: #1e40af; font-size: 18px; margin-bottom: 15px;">üíµ Your Revenue Projection</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <div style="font-size: 12px; color: #6b7280; font-weight: 600;">Monthly Revenue</div>
                        <div style="font-size: 28px; color: #10b981; font-weight: 700;" id="monthlyRev">$12,730</div>
                        <div style="font-size: 11px; color: #9ca3af; margin-top: 2px;">Gross before any expenses</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #6b7280; font-weight: 600;">Annual Revenue</div>
                        <div style="font-size: 28px; color: #10b981; font-weight: 700;" id="annualRev">$152,760</div>
                        <div style="font-size: 11px; color: #9ca3af; margin-top: 2px;">Gross before any expenses</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #6b7280; font-weight: 600;">From Intakes</div>
                        <div style="font-size: 20px; color: #3b82f6; font-weight: 700;" id="intakeRev">$1,458</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #6b7280; font-weight: 600;">From Follow-ups</div>
                        <div style="font-size: 20px; color: #3b82f6; font-weight: 700;" id="followupRev">$11,272</div>
                    </div>
                </div>
                <div style="background: #eff6ff; padding: 12px; border-radius: 6px; font-size: 13px; color: #1e40af; border-left: 3px solid #3b82f6;">
                    <strong>üí° Note:</strong> This is <strong>gross revenue</strong> (what you bill). Actual take-home depends on practice expenses like rent, staff, insurance, etc.
                </div>
                <div style="background: #f9fafb; padding: 12px; border-radius: 6px; font-size: 13px; color: #4b5563; margin-top: 10px;">
                    <strong>Revenue Mix:</strong> <span id="revenueMix">11% from new intakes, 89% from ongoing follow-ups</span>
                </div>
            </div>
        </div>
        
        <div class="comparison-tool" style="margin-top: 20px;">
            <h3>üéØ Revenue Target Calculator</h3>
            <p style="color: #6b7280; font-size: 14px; margin-bottom: 15px;">Set your annual revenue goal and see the patient volume needed to achieve it</p>
            
            <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #3b82f6;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 10px;">
                    <h4 style="font-size: 14px; font-weight: 600; color: #1e40af; margin: 0;">Insurance Panel Selection</h4>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="selectTopPayers(3, 'reverse')" style="padding: 6px 12px; border: 2px solid #10b981; background: white; color: #10b981; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Top 3</button>
                        <button onclick="selectTopPayers(4, 'reverse')" style="padding: 6px 12px; border: 2px solid #10b981; background: white; color: #10b981; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Top 4</button>
                        <button onclick="selectTopPayers(5, 'reverse')" style="padding: 6px 12px; border: 2px solid #10b981; background: white; color: #10b981; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Top 5</button>
                        <button onclick="clearAllPayers('reverse')" style="padding: 6px 12px; border: 2px solid #dc2626; background: white; color: #dc2626; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Clear All</button>
                    </div>
                </div>
                <p style="font-size: 12px; color: #6b7280; margin-bottom: 10px;">Select insurers you accept (or leave blank for overall average)</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="reverse-insurer-checkbox" value="0" onchange="calculateReverse()"> Aetna
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="reverse-insurer-checkbox" value="1" onchange="calculateReverse()"> Anthem BCBS
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="reverse-insurer-checkbox" value="2" onchange="calculateReverse()"> Carelon
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="reverse-insurer-checkbox" value="3" onchange="calculateReverse()"> Cigna
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="reverse-insurer-checkbox" value="4" onchange="calculateReverse()"> Independence BCBS PA
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="reverse-insurer-checkbox" value="5" onchange="calculateReverse()"> Oscar
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="reverse-insurer-checkbox" value="6" onchange="calculateReverse()"> Oxford
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="reverse-insurer-checkbox" value="7" onchange="calculateReverse()"> Quest
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="reverse-insurer-checkbox" value="8" onchange="calculateReverse()"> UnitedHealthcare
                    </label>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 8px;">
                        Target Annual Revenue: <span id="targetRevenueDisplay" style="color: #1e40af;">$200,000</span>
                    </label>
                    <input type="range" id="targetRevenue" value="200000" min="50000" max="5000000" step="10000"
                           style="width: 100%;"
                           oninput="document.getElementById('targetRevenueDisplay').textContent = '$' + parseInt(this.value).toLocaleString(); calculateReverse();">
                    <div style="font-size: 11px; color: #9ca3af; margin-top: 3px;">Gross revenue goal (before expenses)</div>
                </div>
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 5px;">Intake Code</label>
                    <select id="reverseIntakeCode" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" onchange="calculateReverse()">
                        <option value="90791">90791 - Standard Eval</option>
                        <option value="90792">90792 - Eval + Medical</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 5px;">Follow-up Code</label>
                    <select id="reverseFollowupCode" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" onchange="calculateReverse()">
                        <option value="99213">99213 + 90833 (20 min)</option>
                        <option value="99214" selected>99214 + 90833 (30 min)</option>
                    </select>
                </div>
            </div>
            
            <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <h4 style="color: #1e40af; font-size: 16px; margin-bottom: 10px;">üìä Patient Volume Needed</h4>
                <p style="font-size: 12px; color: #6b7280; margin-bottom: 15px;">Based on an established practice (10% new intakes, 90% follow-ups)</p>
                <div id="reverseResult" style="background: #f9fafb; padding: 18px; border-radius: 8px;">
                    <!-- Result will be populated by JavaScript -->
                </div>
                <div style="background: #eff6ff; padding: 12px; border-radius: 6px; margin-top: 15px; font-size: 12px; color: #1e40af;">
                    <strong>üí° Note:</strong> This is <strong>gross revenue</strong> (what you bill). Your actual take-home will be less after practice expenses like rent, staff, insurance, etc.
                </div>
            </div>
        </div>
        
        <div class="comparison-tool" style="margin-top: 20px;">
            <h3>üìà Practice Scaling & Staffing Calculator</h3>
            <p style="color: #6b7280; font-size: 14px; margin-bottom: 15px;">See how adding providers affects your revenue and profit</p>
            
            <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #3b82f6;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 10px;">
                    <h4 style="font-size: 14px; font-weight: 600; color: #1e40af; margin: 0;">Insurance Panel Selection</h4>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="selectTopPayers(3, 'scaling')" style="padding: 6px 12px; border: 2px solid #10b981; background: white; color: #10b981; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Top 3</button>
                        <button onclick="selectTopPayers(4, 'scaling')" style="padding: 6px 12px; border: 2px solid #10b981; background: white; color: #10b981; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Top 4</button>
                        <button onclick="selectTopPayers(5, 'scaling')" style="padding: 6px 12px; border: 2px solid #10b981; background: white; color: #10b981; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Top 5</button>
                        <button onclick="clearAllPayers('scaling')" style="padding: 6px 12px; border: 2px solid #dc2626; background: white; color: #dc2626; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Clear All</button>
                    </div>
                </div>
                <p style="font-size: 12px; color: #6b7280; margin-bottom: 10px;">Select insurers you accept (or leave blank for overall average)</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="scaling-insurer-checkbox" value="0" onchange="calculateScaling()"> Aetna
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="scaling-insurer-checkbox" value="1" onchange="calculateScaling()"> Anthem BCBS
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="scaling-insurer-checkbox" value="2" onchange="calculateScaling()"> Carelon
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="scaling-insurer-checkbox" value="3" onchange="calculateScaling()"> Cigna
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="scaling-insurer-checkbox" value="4" onchange="calculateScaling()"> Independence BCBS PA
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="scaling-insurer-checkbox" value="5" onchange="calculateScaling()"> Oscar
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="scaling-insurer-checkbox" value="6" onchange="calculateScaling()"> Oxford
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="scaling-insurer-checkbox" value="7" onchange="calculateScaling()"> Quest
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" class="scaling-insurer-checkbox" value="8" onchange="calculateScaling()"> UnitedHealthcare
                    </label>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 5px;">Practice Model</label>
                    <select id="scalingScenario" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; font-weight: 600;" onchange="calculateScaling()">
                        <option value="solo">Solo Practice (Just You)</option>
                        <option value="1panp">You + 1 PA/NP</option>
                        <option value="2panp">You + 2 PA/NPs</option>
                        <option value="1md">You + 1 MD Partner</option>
                        <option value="1md1panp">You + 1 MD + 1 PA/NP</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 8px;">
                        Your Monthly Patients: <span id="mdPatientsDisplay" style="color: #1e40af;">70</span>
                    </label>
                    <input type="range" id="mdPatients" value="70" min="0" max="1000"
                           style="width: 100%;"
                           oninput="document.getElementById('mdPatientsDisplay').textContent = this.value; calculateScaling();">
                    <div style="font-size: 11px; color: #9ca3af; margin-top: 3px;">Your patient visits per month</div>
                </div>
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 8px;">
                        PA/NP Salary: <span id="paNpSalaryDisplay" style="color: #1e40af;">$120,000</span>
                    </label>
                    <input type="range" id="paNpSalary" value="120000" min="80000" max="225000" step="5000"
                           style="width: 100%;"
                           oninput="document.getElementById('paNpSalaryDisplay').textContent = '$' + parseInt(this.value).toLocaleString(); calculateScaling();">
                    <div style="font-size: 11px; color: #9ca3af; margin-top: 3px;">Annual salary for PA/NP</div>
                </div>
                <div>
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 8px;">
                        Partner MD Salary: <span id="mdSalaryDisplay" style="color: #1e40af;">$200,000</span>
                    </label>
                    <input type="range" id="mdSalary" value="200000" min="150000" max="500000" step="10000"
                           style="width: 100%;"
                           oninput="document.getElementById('mdSalaryDisplay').textContent = '$' + parseInt(this.value).toLocaleString(); calculateScaling();">
                    <div style="font-size: 11px; color: #9ca3af; margin-top: 3px;">Annual salary for partner physician</div>
                </div>
            </div>
            
            <div style="background: #eff6ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #3b82f6;">
                <h4 style="font-size: 14px; font-weight: 600; color: #1e40af; margin-bottom: 8px;">üí° How to Read These Numbers:</h4>
                <ul style="font-size: 13px; color: #4b5563; line-height: 1.8; margin: 0; padding-left: 20px;">
                    <li><strong>Gross Revenue</strong> = Total you bill to insurance</li>
                    <li><strong>Provider Salaries</strong> = What you pay staff (not including yourself)</li>
                    <li><strong>Net Profit</strong> = Gross Revenue minus Staff Salaries (before paying yourself, rent, EHR, etc.)</li>
                </ul>
            </div>
            
            <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                <h4 style="color: #1e40af; font-size: 16px; margin-bottom: 15px;" id="scalingTitle">üíº Your Practice Projection</h4>
                <div id="scalingResult">
                    <!-- Scaling result will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="info-section">
        <h2>About Headway's Payment Model</h2>
        <p>According to Headway, they do not operate on the traditional 1099 model of splitting reimbursements on a 60/40 or 70/30 basis. They state that providers receive the full reimbursement from insurance companies based on Headway's service level agreements. Headway reports that these agreements are established based on the population they offer preventative care to, which allows them to cover their operational costs by collecting payment directly from insurance payers, rather than splitting provider rates or charging patients additional fees.</p>
    </div>
    
    <div class="footer">
        Joseph Psychiatry PLLC | Rates current as of November 2025 | Enhanced Analytics Version
    </div>

<script>
// Data structure with all rates
const ratesData = [
    {code: '90785', desc: 'Interactive Complexity', category: 'other', duration: 'addon', 
     rates: [17.04, 13.00, 0, 4.69, 13.34, 15.34, 15.34, 13.74, 15.34]},
    {code: '90791', desc: 'Psychiatric diagnostic evaluation', category: 'evaluation', duration: 'extended',
     rates: [199.53, 159.00, 151.79, 189.00, 156.57, 192.92, 192.92, 166.12, 192.92]},
    {code: '90792', desc: 'Psychiatric diagnostic evaluation with medical services', category: 'evaluation', duration: 'extended',
     rates: [178.63, 179.00, 170.87, 200.64, 176.61, 192.92, 192.92, 181.58, 192.92]},
    {code: '90832', desc: 'Psychotherapy, 30 minutes with patient (16-37 minutes)', category: 'psychotherapy', duration: 'medium',
     rates: [90.91, 69.00, 69.00, 81.00, 71.16, 80.27, 80.27, 72.29, 80.27]},
    {code: '90833', desc: 'Psychotherapy, 30 minutes with patient when performed with an evaluation and management service (16-37 minutes)', category: 'psychotherapy', duration: 'medium',
     rates: [105.60, 76.00, 63.42, 73.00, 68.82, 73.49, 73.49, 66.56, 73.49]},
    {code: '90834', desc: 'Psychotherapy, 45 minutes with patient (38-52 minutes)', category: 'psychotherapy', duration: 'long',
     rates: [161.02, 91.00, 91.01, 122.00, 98.54, 105.95, 105.95, 95.38, 105.95]},
    {code: '90836', desc: 'Psychotherapy, 45 minutes with patient when performed with an evaluation and management service (38-52 minutes)', category: 'psychotherapy', duration: 'long',
     rates: [153.51, 96.00, 80.16, 98.00, 82.81, 92.76, 92.76, 84.13, 92.76]},
    {code: '90837', desc: 'Psychotherapy, 60 minutes with patient (53+ minutes)', category: 'psychotherapy', duration: 'extended',
     rates: [196.24, 134.00, 134.17, 181.00, 138.34, 155.53, 155.53, 140.59, 155.53]},
    {code: '90838', desc: 'Psychotherapy, 60 minutes with patient when performed with an evaluation and management service (53+ minutes)', category: 'psychotherapy', duration: 'extended',
     rates: [185.26, 127.00, 106.28, 124.00, 109.83, 122.00, 122.00, 111.60, 122.00]},
    {code: '90839', desc: 'Psychotherapy for crisis; first 60 minutes', category: 'crisis', duration: 'extended',
     rates: [164.61, 128.00, 129.19, 103.00, 133.30, 144.27, 144.27, 135.49, 144.27]},
    {code: '90840', desc: 'Psychotherapy for crisis; each additional 30 minutes', category: 'crisis', duration: 'medium',
     rates: [54.79, 65.00, 64.01, 77.00, 66.20, 30.27, 30.27, 67.18, 30.27]},
    {code: '90846', desc: 'Family psychotherapy (without the patient present), 50 minutes', category: 'family', duration: 'long',
     rates: [136.36, 86.00, 86.02, 117.42, 106.20, 101.31, 101.31, 99.72, 101.31]},
    {code: '90847', desc: 'Family psychotherapy (conjoint psychotherapy) (with patient present), 50 minutes', category: 'family', duration: 'long',
     rates: [135.68, 89.00, 90.13, 143.70, 111.26, 104.88, 104.88, 103.64, 104.88]},
    {code: '90853', desc: 'Group psychotherapy (other than of a multiple-family group)', category: 'family', duration: 'medium',
     rates: [68.18, 24.00, 24.37, 80.46, 32.70, 28.19, 28.19, 25.55, 28.19]},
    {code: '99202', desc: 'Office or other outpatient visit for the evaluation and management of a new patient (15 minutes)', category: 'evaluation', duration: 'short',
     rates: [68.07, 69.00, 63.71, 82.80, 66.43, 77.59, 77.59, 73.17, 77.59]},
    {code: '99203', desc: 'Office or other outpatient visit for the evaluation and management of a new patient (30 minutes)', category: 'evaluation', duration: 'medium',
     rates: [106.97, 106.00, 98.35, 123.13, 102.55, 121.39, 121.39, 106.84, 121.39]},
    {code: '99204', desc: 'Office or other outpatient visit for the evaluation and management of a new patient (45 minutes)', category: 'evaluation', duration: 'long',
     rates: [175.80, 189.00, 147.38, 173.35, 153.50, 174.80, 174.80, 157.77, 174.80]},
    {code: '99205', desc: 'Office or other outpatient visit for the evaluation and management of a new patient (60 minutes)', category: 'evaluation', duration: 'extended',
     rates: [228.48, 208.00, 194.36, 222.00, 202.42, 231.16, 231.16, 207.94, 231.16]},
    {code: '99212', desc: 'Office or other outpatient visit for the evaluation and management of an established patient (10 minutes)', category: 'evaluation', duration: 'short',
     rates: [52.00, 54.00, 49.91, 49.59, 52.06, 50.00, 50.00, 54.44, 50.00]},
    {code: '99213', desc: 'Office or other outpatient visit for the evaluation and management of an established patient (20 minutes)', category: 'evaluation', duration: 'medium',
     rates: [95.69, 102.00, 80.16, 67.50, 83.47, 85.86, 85.86, 86.16, 85.86]},
    {code: '99214', desc: 'Office or other outpatient visit for the evaluation and management of an established patient (30 minutes)', category: 'evaluation', duration: 'medium',
     rates: [138.71, 143.00, 113.04, 115.00, 117.63, 120.91, 120.91, 121.52, 120.91]},
    {code: '99215', desc: 'Office or other outpatient visit for the evaluation and management of an established patient (40 minutes)', category: 'evaluation', duration: 'long',
     rates: [152.33, 102.59, 159.13, 151.51, 165.61, 169.78, 169.78, 169.82, 169.78]},
    {code: '99404', desc: 'Preventive medicine counseling and/or risk factor reduction', category: 'other', duration: 'medium',
     rates: [0, 0, 0, 122.00, 0, 0, 0, 0, 0]}
];

const insurerNames = ['Aetna', 'Anthem BCBS', 'Carelon', 'Cigna', 'Independence BCBS PA', 'Oscar', 'Oxford', 'Quest', 'UnitedHealthcare'];

// Calculate average rate for each code
ratesData.forEach(row => {
    const validRates = row.rates.filter(r => r > 0);
    row.avgRate = validRates.length > 0 ? validRates.reduce((a, b) => a + b, 0) / validRates.length : 0;
});

// Initialize the page
function initializePage() {
    populateTable();
    updateStatistics();
    populateMedManagementStats();
    createMedManagementCharts();
}

function populateMedManagementStats() {
    // Calculate averages for med management codes
    const code90791 = ratesData.find(r => r.code === '90791');
    const code90792 = ratesData.find(r => r.code === '90792');
    const code99213 = ratesData.find(r => r.code === '99213');
    const code99214 = ratesData.find(r => r.code === '99214');
    const code90833 = ratesData.find(r => r.code === '90833');
    
    document.getElementById('avg90791').textContent = '$' + code90791.avgRate.toFixed(2);
    document.getElementById('avg90792').textContent = '$' + code90792.avgRate.toFixed(2);
    
    // Calculate combo rates
    const avg99213combo = code99213.avgRate + code90833.avgRate;
    const avg99214combo = code99214.avgRate + code90833.avgRate;
    
    document.getElementById('avg99213combo').textContent = '$' + avg99213combo.toFixed(2);
    document.getElementById('avg99214combo').textContent = '$' + avg99214combo.toFixed(2);
}

function createMedManagementCharts() {
    const code90791 = ratesData.find(r => r.code === '90791');
    const code90792 = ratesData.find(r => r.code === '90792');
    const code99213 = ratesData.find(r => r.code === '99213');
    const code99214 = ratesData.find(r => r.code === '99214');
    const code90833 = ratesData.find(r => r.code === '90833');
    
    // Create 90791 intake chart
    const intake90791Data = insurerNames.map((name, idx) => ({
        name,
        rate: code90791.rates[idx]
    })).filter(d => d.rate > 0).sort((a, b) => b.rate - a.rate);
    
    const intake90791Chart = document.getElementById('intake90791Chart');
    const maxIntake90791 = Math.max(...intake90791Data.map(d => d.rate));
    intake90791Chart.innerHTML = '';
    
    intake90791Data.forEach(item => {
        const barItem = document.createElement('div');
        barItem.className = 'bar-item';
        const percentage = (item.rate / maxIntake90791) * 100;
        barItem.innerHTML = `
            <div class="bar-label" style="min-width: 140px; font-size: 12px;">${item.name}</div>
            <div class="bar-wrapper" style="height: 25px;">
                <div class="bar-fill" style="width: ${percentage}%; font-size: 11px;">$${item.rate.toFixed(2)}</div>
            </div>
        `;
        intake90791Chart.appendChild(barItem);
    });
    
    // Create 90792 intake chart
    const intake90792Data = insurerNames.map((name, idx) => ({
        name,
        rate: code90792.rates[idx]
    })).filter(d => d.rate > 0).sort((a, b) => b.rate - a.rate);
    
    const intake90792Chart = document.getElementById('intake90792Chart');
    const maxIntake90792 = Math.max(...intake90792Data.map(d => d.rate));
    intake90792Chart.innerHTML = '';
    
    intake90792Data.forEach(item => {
        const barItem = document.createElement('div');
        barItem.className = 'bar-item';
        const percentage = (item.rate / maxIntake90792) * 100;
        barItem.innerHTML = `
            <div class="bar-label" style="min-width: 140px; font-size: 12px;">${item.name}</div>
            <div class="bar-wrapper" style="height: 25px;">
                <div class="bar-fill" style="width: ${percentage}%; font-size: 11px;">$${item.rate.toFixed(2)}</div>
            </div>
        `;
        intake90792Chart.appendChild(barItem);
    });
    
    // Create 99213 + 90833 follow-up chart
    const followup99213Data = insurerNames.map((name, idx) => ({
        name,
        rate: code99213.rates[idx] + code90833.rates[idx]
    })).filter(d => d.rate > 0).sort((a, b) => b.rate - a.rate);
    
    const followup99213Chart = document.getElementById('followup99213Chart');
    const maxFollowup99213 = Math.max(...followup99213Data.map(d => d.rate));
    followup99213Chart.innerHTML = '';
    
    followup99213Data.forEach(item => {
        const barItem = document.createElement('div');
        barItem.className = 'bar-item';
        const percentage = (item.rate / maxFollowup99213) * 100;
        barItem.innerHTML = `
            <div class="bar-label" style="min-width: 140px; font-size: 12px;">${item.name}</div>
            <div class="bar-wrapper" style="height: 25px;">
                <div class="bar-fill" style="width: ${percentage}%; font-size: 11px;">$${item.rate.toFixed(2)}</div>
            </div>
        `;
        followup99213Chart.appendChild(barItem);
    });
    
    // Create 99214 + 90833 follow-up chart
    const followup99214Data = insurerNames.map((name, idx) => ({
        name,
        rate: code99214.rates[idx] + code90833.rates[idx]
    })).filter(d => d.rate > 0).sort((a, b) => b.rate - a.rate);
    
    const followup99214Chart = document.getElementById('followup99214Chart');
    const maxFollowup99214 = Math.max(...followup99214Data.map(d => d.rate));
    followup99214Chart.innerHTML = '';
    
    followup99214Data.forEach(item => {
        const barItem = document.createElement('div');
        barItem.className = 'bar-item';
        const percentage = (item.rate / maxFollowup99214) * 100;
        barItem.innerHTML = `
            <div class="bar-label" style="min-width: 140px; font-size: 12px;">${item.name}</div>
            <div class="bar-wrapper" style="height: 25px;">
                <div class="bar-fill" style="width: ${percentage}%; font-size: 11px;">$${item.rate.toFixed(2)}</div>
            </div>
        `;
        followup99214Chart.appendChild(barItem);
    });
}

function populateTable() {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';
    
    ratesData.forEach(row => {
        const tr = document.createElement('tr');
        tr.setAttribute('data-category', row.category);
        tr.setAttribute('data-duration', row.duration);
        tr.setAttribute('data-avg-rate', row.avgRate.toFixed(2));
        
        let html = `<td class="cpt-code">${row.code}</td><td class="description">${row.desc}</td>`;
        
        row.rates.forEach(rate => {
            html += `<td class="rate">${rate > 0 ? '$' + rate.toFixed(2) : '‚Äî'}</td>`;
        });
        
        html += `<td class="avg-rate">$${row.avgRate.toFixed(2)}</td>`;
        tr.innerHTML = html;
        tbody.appendChild(tr);
    });
}

function updateStatistics() {
    const totalCodes = ratesData.length;
    const allRates = ratesData.flatMap(r => r.rates.filter(rate => rate > 0));
    const avgRate = allRates.reduce((a, b) => a + b, 0) / allRates.length;
    const highestRate = Math.max(...allRates);
    const highestRateCode = ratesData.find(r => r.rates.includes(highestRate));
    
    document.getElementById('totalCodes').textContent = totalCodes;
    document.getElementById('avgRate').textContent = '$' + avgRate.toFixed(2);
    document.getElementById('highestRate').textContent = '$' + highestRate.toFixed(2);
    document.getElementById('highestRateCode').textContent = 'CPT ' + highestRateCode.code;
}

function searchTable() {
    const input = document.getElementById('searchInput');
    const filter = input.value.toLowerCase();
    const rows = document.querySelectorAll('#tableBody tr');
    
    rows.forEach(row => {
        const code = row.cells[0].textContent.toLowerCase();
        const desc = row.cells[1].textContent.toLowerCase();
        row.style.display = (code.includes(filter) || desc.includes(filter)) ? '' : 'none';
    });
}

function filterTable(category, button) {
    // Update active button
    document.querySelectorAll('.filter-group .filter-btn').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
    
    // Clear search and other filters
    document.getElementById('searchInput').value = '';
    
    const rows = document.querySelectorAll('#tableBody tr');
    
    if (category === 'mypractice') {
        // Show only the 5 practice codes in specific order
        const practiceCodes = ['90791', '90792', '99213', '99214', '90833'];
        rows.forEach(row => {
            const code = row.cells[0].textContent.trim();
            row.style.display = practiceCodes.includes(code) ? '' : 'none';
        });
        
        // Sort them in the correct order
        const tbody = document.getElementById('tableBody');
        const visibleRows = Array.from(rows).filter(row => row.style.display !== 'none');
        visibleRows.sort((a, b) => {
            const codeA = a.cells[0].textContent.trim();
            const codeB = b.cells[0].textContent.trim();
            return practiceCodes.indexOf(codeA) - practiceCodes.indexOf(codeB);
        });
        visibleRows.forEach(row => tbody.appendChild(row));
    } else {
        rows.forEach(row => {
            const rowCategory = row.getAttribute('data-category');
            row.style.display = (category === 'all' || rowCategory === category) ? '' : 'none';
        });
    }
}

function resetAllFilters() {
    // Reset all filter buttons
    document.querySelectorAll('.filter-section .filter-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('.filter-group .filter-btn').classList.add('active'); // Activate "All Codes"
    
    // Clear search
    document.getElementById('searchInput').value = '';
    
    // Show all rows
    const rows = document.querySelectorAll('#tableBody tr');
    rows.forEach(row => {
        row.style.display = '';
    });
    
    // Reset table to original order
    populateTable();
}

function filterByDuration(duration, button) {
    document.querySelectorAll('.filter-section:nth-child(3) .filter-btn').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
    
    const rows = document.querySelectorAll('#tableBody tr');
    rows.forEach(row => {
        const rowDuration = row.getAttribute('data-duration');
        row.style.display = (rowDuration === duration) ? '' : 'none';
    });
}

function filterByRate(range, button) {
    document.querySelectorAll('.filter-section:nth-child(4) .filter-btn').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
    
    const rows = document.querySelectorAll('#tableBody tr');
    rows.forEach(row => {
        const avgRate = parseFloat(row.getAttribute('data-avg-rate'));
        let show = false;
        
        if (range === 'low' && avgRate < 75) show = true;
        if (range === 'medium' && avgRate >= 75 && avgRate < 150) show = true;
        if (range === 'high' && avgRate >= 150) show = true;
        
        row.style.display = show ? '' : 'none';
    });
}

function sortTable() {
    const sortValue = document.getElementById('sortSelect').value;
    const tbody = document.getElementById('tableBody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    
    rows.sort((a, b) => {
        if (sortValue === 'code-asc') {
            return a.cells[0].textContent.localeCompare(b.cells[0].textContent);
        } else if (sortValue === 'code-desc') {
            return b.cells[0].textContent.localeCompare(a.cells[0].textContent);
        } else if (sortValue === 'avg-high') {
            return parseFloat(b.getAttribute('data-avg-rate')) - parseFloat(a.getAttribute('data-avg-rate'));
        } else if (sortValue === 'avg-low') {
            return parseFloat(a.getAttribute('data-avg-rate')) - parseFloat(b.getAttribute('data-avg-rate'));
        }
        return 0;
    });
    
    rows.forEach(row => tbody.appendChild(row));
}

function toggleHighlight(mode, button) {
    document.querySelectorAll('.view-toggle .view-btn').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
    
    const rateCells = document.querySelectorAll('#tableBody td.rate');
    rateCells.forEach(cell => {
        cell.classList.remove('highlight-high', 'highlight-low');
    });
    
    if (mode === 'extremes') {
        const rows = document.querySelectorAll('#tableBody tr');
        rows.forEach(row => {
            const rateCells = Array.from(row.querySelectorAll('.rate')).slice(0, -1); // Exclude avg column
            const rates = rateCells.map(c => {
                const text = c.textContent.replace('$', '').replace('‚Äî', '0');
                return parseFloat(text);
            }).filter(r => r > 0);
            
            if (rates.length > 0) {
                const maxRate = Math.max(...rates);
                const minRate = Math.min(...rates);
                
                rateCells.forEach(cell => {
                    const rate = parseFloat(cell.textContent.replace('$', '').replace('‚Äî', '0'));
                    if (rate === maxRate && rate > 0) cell.classList.add('highlight-high');
                    if (rate === minRate && rate > 0 && minRate !== maxRate) cell.classList.add('highlight-low');
                });
            }
        });
    }
}

function sortTableByColumn(columnIndex) {
    const table = document.getElementById('dataTable');
    const tbody = document.getElementById('tableBody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const headers = table.querySelectorAll('th');
    const currentHeader = headers[columnIndex];
    
    // Get current sort direction
    let currentSort = currentHeader.getAttribute('data-sort') || '';
    let newSort = currentSort === 'asc' ? 'desc' : 'asc';
    
    // Clear all other headers
    headers.forEach(h => {
        h.setAttribute('data-sort', '');
        h.classList.remove('sorted-asc', 'sorted-desc');
    });
    
    // Set new sort direction
    currentHeader.setAttribute('data-sort', newSort);
    currentHeader.classList.add(newSort === 'asc' ? 'sorted-asc' : 'sorted-desc');
    
    // Sort rows
    rows.sort((a, b) => {
        let aValue = a.cells[columnIndex].textContent.trim();
        let bValue = b.cells[columnIndex].textContent.trim();
        
        // Handle currency values
        if (aValue.includes('$')) {
            aValue = parseFloat(aValue.replace('$', '').replace(',', '')) || 0;
            bValue = parseFloat(bValue.replace('$', '').replace(',', '')) || 0;
            return newSort === 'asc' ? aValue - bValue : bValue - aValue;
        }
        
        // Handle text values
        if (newSort === 'asc') {
            return aValue.localeCompare(bValue);
        } else {
            return bValue.localeCompare(aValue);
        }
    });
    
    // Re-append sorted rows
    rows.forEach(row => tbody.appendChild(row));
}

function calculateRevenue() {
    const newPatientsMonth = parseInt(document.getElementById('newPatientsMonth').value) || 0;
    const followupVisitsMonth = parseInt(document.getElementById('followupVisitsMonth').value) || 0;
    const intakeCode = document.getElementById('intakeCode').value;
    const followupCode = document.getElementById('followupCode').value;
    
    // Get checked insurers
    const checkedInsurers = Array.from(document.querySelectorAll('.insurer-checkbox:checked')).map(cb => parseInt(cb.value));
    
    // Get intake code data
    const intakeData = ratesData.find(r => r.code === intakeCode);
    
    // Get follow-up codes data (E&M + 90833)
    const emCode = ratesData.find(r => r.code === followupCode);
    const code90833 = ratesData.find(r => r.code === '90833');
    
    if (!intakeData || !emCode || !code90833) return;
    
    // Calculate rates based on insurance selection
    let intakeRate, followupRate;
    if (checkedInsurers.length === 0) {
        // Use average of all
        intakeRate = intakeData.avgRate;
        followupRate = emCode.avgRate + code90833.avgRate;
    } else {
        // Calculate weighted average of selected insurers
        const intakeRates = checkedInsurers.map(idx => intakeData.rates[idx]).filter(r => r > 0);
        const followupRates = checkedInsurers.map(idx => emCode.rates[idx] + code90833.rates[idx]).filter(r => r > 0);
        intakeRate = intakeRates.reduce((a, b) => a + b, 0) / intakeRates.length;
        followupRate = followupRates.reduce((a, b) => a + b, 0) / followupRates.length;
    }
    
    // Calculate revenue
    const intakeRevenue = newPatientsMonth * intakeRate;
    const followupRevenue = followupVisitsMonth * followupRate;
    const monthlyRevenue = intakeRevenue + followupRevenue;
    const annualRevenue = monthlyRevenue * 12;
    
    // Calculate percentages
    const intakePercent = monthlyRevenue > 0 ? (intakeRevenue / monthlyRevenue * 100).toFixed(0) : 0;
    const followupPercent = monthlyRevenue > 0 ? (followupRevenue / monthlyRevenue * 100).toFixed(0) : 0;
    
    // Update display
    document.getElementById('monthlyRev').textContent = '$' + monthlyRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    document.getElementById('annualRev').textContent = '$' + annualRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    document.getElementById('intakeRev').textContent = '$' + intakeRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    document.getElementById('followupRev').textContent = '$' + followupRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    document.getElementById('revenueMix').textContent = `${intakePercent}% from new intakes, ${followupPercent}% from ongoing follow-ups`;
}

function calculateReverse() {
    const targetAnnual = parseInt(document.getElementById('targetRevenue').value) || 0;
    const targetMonthly = targetAnnual / 12;
    const intakeMixPercent = 10; // Fixed at 10% for established practice
    const intakeCode = document.getElementById('reverseIntakeCode').value;
    const followupCode = document.getElementById('reverseFollowupCode').value;
    
    // Get checked insurers
    const checkedInsurers = Array.from(document.querySelectorAll('.reverse-insurer-checkbox:checked')).map(cb => parseInt(cb.value));
    
    // Get rate data
    const intakeData = ratesData.find(r => r.code === intakeCode);
    const emCode = ratesData.find(r => r.code === followupCode);
    const code90833 = ratesData.find(r => r.code === '90833');
    
    if (!intakeData || !emCode || !code90833) return;
    
    // Calculate rates
    let intakeRate, followupRate;
    if (checkedInsurers.length === 0) {
        intakeRate = intakeData.avgRate;
        followupRate = emCode.avgRate + code90833.avgRate;
    } else {
        const intakeRates = checkedInsurers.map(idx => intakeData.rates[idx]).filter(r => r > 0);
        const followupRates = checkedInsurers.map(idx => emCode.rates[idx] + code90833.rates[idx]).filter(r => r > 0);
        intakeRate = intakeRates.reduce((a, b) => a + b, 0) / intakeRates.length;
        followupRate = followupRates.reduce((a, b) => a + b, 0) / followupRates.length;
    }
    
    const intakeMix = intakeMixPercent / 100;
    
    // Calculate needed visits
    const totalVisits = targetMonthly / ((intakeRate * intakeMix) + (followupRate * (1 - intakeMix)));
    const intakes = Math.round(totalVisits * intakeMix);
    const followups = Math.round(totalVisits * (1 - intakeMix));
    const actualMonthly = (intakes * intakeRate + followups * followupRate);
    const actualAnnual = actualMonthly * 12;
    
    // Display result
    const container = document.getElementById('reverseResult');
    container.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
            <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #3b82f6;">
                <div style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">New Intakes/Month</div>
                <div style="font-size: 32px; color: #1e40af; font-weight: 700;">${intakes}</div>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #3b82f6;">
                <div style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">Follow-ups/Month</div>
                <div style="font-size: 32px; color: #1e40af; font-weight: 700;">${followups}</div>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #10b981;">
                <div style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">Total Visits/Month</div>
                <div style="font-size: 32px; color: #10b981; font-weight: 700;">${intakes + followups}</div>
            </div>
        </div>
        <div style="background: #d1fae5; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
            <div style="font-size: 13px; color: #065f46; margin-bottom: 8px;"><strong>Projected Revenue:</strong></div>
            <div style="font-size: 24px; color: #065f46; font-weight: 700; margin-bottom: 5px;">$${actualMonthly.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} <span style="font-size: 16px;">/month</span></div>
            <div style="font-size: 20px; color: #065f46; font-weight: 600;">$${actualAnnual.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} <span style="font-size: 14px;">/year</span></div>
        </div>
    `;
}

function calculateScaling() {
    const selectedScenario = document.getElementById('scalingScenario').value;
    const mdPatients = parseInt(document.getElementById('mdPatients').value) || 0;
    const paNpSalary = parseInt(document.getElementById('paNpSalary').value) || 120000;
    const mdSalary = parseInt(document.getElementById('mdSalary').value) || 200000;
    
    // Get checked insurers
    const checkedInsurers = Array.from(document.querySelectorAll('.scaling-insurer-checkbox:checked')).map(cb => parseInt(cb.value));
    
    // Calculate average rate
    const code99214 = ratesData.find(r => r.code === '99214');
    const code90833 = ratesData.find(r => r.code === '90833');
    
    let avgRate;
    if (checkedInsurers.length === 0) {
        avgRate = code99214.avgRate + code90833.avgRate;
    } else {
        const rates = checkedInsurers.map(idx => code99214.rates[idx] + code90833.rates[idx]).filter(r => r > 0);
        avgRate = rates.reduce((a, b) => a + b, 0) / rates.length;
    }
    
    const paNpRate = avgRate * 0.87;
    const paNpPatients = 50;
    
    let scenario = {};
    
    switch(selectedScenario) {
        case 'solo':
            scenario = {
                name: 'Solo Practice',
                providers: 'Just You',
                patients: mdPatients,
                revenue: mdPatients * avgRate * 12,
                costs: 0,
                profit: mdPatients * avgRate * 12
            };
            break;
        case '1panp':
            scenario = {
                name: 'You + 1 PA/NP',
                providers: 'You + 1 PA or NP',
                patients: mdPatients + paNpPatients,
                revenue: (mdPatients * avgRate + paNpPatients * paNpRate) * 12,
                costs: paNpSalary,
                profit: (mdPatients * avgRate + paNpPatients * paNpRate) * 12 - paNpSalary
            };
            break;
        case '2panp':
            scenario = {
                name: 'You + 2 PA/NPs',
                providers: 'You + 2 PAs/NPs',
                patients: mdPatients + (paNpPatients * 2),
                revenue: (mdPatients * avgRate + (paNpPatients * 2) * paNpRate) * 12,
                costs: paNpSalary * 2,
                profit: (mdPatients * avgRate + (paNpPatients * 2) * paNpRate) * 12 - (paNpSalary * 2)
            };
            break;
        case '1md':
            scenario = {
                name: 'You + Partner MD',
                providers: 'You + 1 MD Partner',
                patients: mdPatients * 2,
                revenue: (mdPatients * 2) * avgRate * 12,
                costs: mdSalary,
                profit: (mdPatients * 2) * avgRate * 12 - mdSalary
            };
            break;
        case '1md1panp':
            scenario = {
                name: 'You + MD + PA/NP',
                providers: 'You + 1 MD + 1 PA/NP',
                patients: (mdPatients * 2) + paNpPatients,
                revenue: ((mdPatients * 2) * avgRate + paNpPatients * paNpRate) * 12,
                costs: mdSalary + paNpSalary,
                profit: ((mdPatients * 2) * avgRate + paNpPatients * paNpRate) * 12 - (mdSalary + paNpSalary)
            };
            break;
    }
    
    const monthlyProfit = scenario.profit / 12;
    const container = document.getElementById('scalingResult');
    
    container.innerHTML = `
        <div style="background: #f9fafb; padding: 18px; border-radius: 8px; margin-bottom: 15px;">
            <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;"><strong>Team Structure:</strong> ${scenario.providers}</div>
            <div style="font-size: 14px; color: #4b5563;"><strong>${scenario.patients}</strong> total patient visits per month</div>
        </div>
        
        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 12px; border: 2px solid #10b981;">
            <div style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">Gross Revenue (Annual)</div>
            <div style="font-size: 28px; color: #10b981; font-weight: 700;">$${scenario.revenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</div>
            <div style="font-size: 13px; color: #6b7280; margin-top: 3px;">What you bill to insurance</div>
        </div>
        
        ${scenario.costs > 0 ? `
        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 12px; border: 2px solid #ef4444;">
            <div style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">Provider Salaries (Annual)</div>
            <div style="font-size: 28px; color: #ef4444; font-weight: 700;">-$${scenario.costs.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</div>
            <div style="font-size: 13px; color: #6b7280; margin-top: 3px;">What you pay staff</div>
        </div>
        ` : ''}
        
        <div style="background: ${scenario.profit > 0 ? '#d1fae5' : '#fee2e2'}; padding: 20px; border-radius: 8px; border: 3px solid ${scenario.profit > 0 ? '#10b981' : '#ef4444'};">
            <div style="font-size: 14px; color: #4b5563; font-weight: 600; margin-bottom: 10px;">üí∞ Net Profit (before paying yourself, rent, EHR, etc.)</div>
            <div style="font-size: 32px; color: ${scenario.profit > 0 ? '#065f46' : '#991b1b'}; font-weight: 700; margin-bottom: 8px;">
                $${scenario.profit.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} <span style="font-size: 18px;">/year</span>
            </div>
            <div style="font-size: 24px; color: ${scenario.profit > 0 ? '#065f46' : '#991b1b'}; font-weight: 600;">
                $${monthlyProfit.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} <span style="font-size: 16px;">/month</span>
            </div>
        </div>
    `;
}

function selectTopPayers(count, type) {
    // Get the top paying insurers based on 99214 + 90833 combo
    const code99214 = ratesData.find(r => r.code === '99214');
    const code90833 = ratesData.find(r => r.code === '90833');
    
    const insurerRates = insurerNames.map((name, idx) => ({
        idx,
        rate: code99214.rates[idx] + code90833.rates[idx]
    })).filter(i => i.rate > 0).sort((a, b) => b.rate - a.rate);
    
    const topPayers = insurerRates.slice(0, count).map(i => i.idx);
    
    // Clear and check the appropriate checkboxes
    let checkboxClass;
    if (type === 'forward') checkboxClass = '.insurer-checkbox';
    else if (type === 'reverse') checkboxClass = '.reverse-insurer-checkbox';
    else if (type === 'scaling') checkboxClass = '.scaling-insurer-checkbox';
    
    document.querySelectorAll(checkboxClass).forEach(cb => {
        cb.checked = topPayers.includes(parseInt(cb.value));
    });
    
    // Recalculate
    if (type === 'forward') {
        calculateRevenue();
    } else if (type === 'reverse') {
        calculateReverse();
    } else if (type === 'scaling') {
        calculateScaling();
    }
}

function clearAllPayers(type) {
    let checkboxClass;
    if (type === 'forward') checkboxClass = '.insurer-checkbox';
    else if (type === 'reverse') checkboxClass = '.reverse-insurer-checkbox';
    else if (type === 'scaling') checkboxClass = '.scaling-insurer-checkbox';
    
    document.querySelectorAll(checkboxClass).forEach(cb => {
        cb.checked = false;
    });
    
    // Recalculate
    if (type === 'forward') {
        calculateRevenue();
    } else if (type === 'reverse') {
        calculateReverse();
    } else if (type === 'scaling') {
        calculateScaling();
    }
}

// Initialize on page load
window.onload = function() {
    initializePage();
    calculateRevenue();
    calculateReverse();
    calculateScaling();
};
</script>
</body>
</html>